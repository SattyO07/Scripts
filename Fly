local flyEnabled = false
local flySpeed = 50
local flyConnection

-- Function to toggle flying
local function toggleFly()
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

    if not flyEnabled then
        flyEnabled = true

        local bodyGyro = Instance.new("BodyGyro")
        bodyGyro.P = 9e4
        bodyGyro.maxTorque = Vector3.new(9e9, 9e9, 9e9)
        bodyGyro.cframe = humanoidRootPart.CFrame
        bodyGyro.Parent = humanoidRootPart

        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.velocity = Vector3.new(0, 0.1, 0)
        bodyVelocity.maxForce = Vector3.new(9e9, 9e9, 9e9)
        bodyVelocity.Parent = humanoidRootPart

        humanoidRootPart.Anchored = true

        flyConnection = game:GetService("RunService").RenderStepped:Connect(function()
            if flyEnabled then
                local cf = game.Workspace.CurrentCamera.CFrame
                bodyGyro.cframe = cf
                bodyVelocity.velocity = cf.lookVector * flySpeed
            else
                flyConnection:Disconnect()
            end
        end)
    else
        flyEnabled = false

        for _, child in ipairs(humanoidRootPart:GetChildren()) do
            if child:IsA("BodyGyro") or child:IsA("BodyVelocity") then
                child:Destroy()
            end
        end
        humanoidRootPart.Anchored = false
    end
end

-- Function to set fly speed
local function speedFly(speed)
    flySpeed = speed
end

-- Example Usage:
-- toggleFly() -- Call to start flying
-- speedFly(100) -- Set fly speed to 100
-- toggleFly() -- Call again to stop flying
